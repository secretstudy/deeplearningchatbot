<!DOCTYPE html>
<html>
<head>
    <title>음식주문</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style >

.chat_content {height: 600px;width: 500px;overflow-y:scroll;padding:10px 15px;background: cornflowerblue}
.chat_input {padding:2px 5px;}
.chat_header {padding: 10px 15px;border-bottom: 1px solid #95a6b4;}
.chat_header .close_btn {border: none;background: none;float: right;}
.send_btn {;border: 1px solid #666;background: #00fd11;height: 28px;color: #0a0a0a;}
.msg_box:after {content: '';display: block;clear:both;}
.msg_box > span {padding: 3px 5px;word-break: break-all;display: block;max-width: 300px;margin-bottom: 10px;border-radius: 4px}
.msg_box.send > span {background:#ffeb33;float: right;}
.msg_box.receive > span {background:#fff;float: left;}
        .chat_header {
            padding: 10px 15px;
            border-bottom: 1px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .chat_content {
            height: 500px;
            width: 500px;
            overflow-y:scroll;
            padding:10px 15px;background: cornflowerblue
        }

        .chat_input {
            padding: 8px;
            width: calc(100% - 75px);
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            outline: none;
        }

        .send_btn {
            border: none;
            background: #00A2FF;
            height: 35px;
            width: 50px;
            color: white;
            border-radius: 20px;
            cursor: pointer;
        }

        /* 사용자 메시지 스타일 */
        .user-bubble {
            background-color: #fff;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 20px;
            color: #000;
            display: inline-block;
            float: right;
            clear: both;
            max-width: 70%;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* 서버 응답 스타일 */
        .server-bubble {
            background-color: #FFF;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 20px;
            display: inline-block;
            float: left;
            clear: both;
            max-width: 70%;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* 스크롤바 스타일 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 5px;
        }
         /* 프로필 이미지 스타일 */
        .profile-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
            margin-bottom: -15px;
        }

        .questioner-profile {
            float: right;
        }

        .answerer-profile {
            float: left;
        }
    </style>
</head>
<body>

<div class="chat_header">
    <span>음식 주문 챗봇</span>
    <button type="button" id="close_chat_btn" class="close_btn">X</button>
</div>
<div id="chat-box" class="chat_content"></div>

<form id="form" style="display: inline">
    <input type="text" name="input1" class="chat_input" id="user-input" size="74" style="display: inline; width: 470px" />
    <input type="button" value="전송" id="send-btn" class="send_btn" style="display: inline;width: 40px"  />
</form>

<script>
    $('#send-btn').click(sendMessage); // 버튼 클릭 시 전송

    // Enter 키 누를 때 전송
    $('#user-input').keypress(function(event) {
        if (event.keyCode === 13) { // Enter 키의 keyCode는 13
            event.preventDefault(); // 폼 제출 방지
            sendMessage();
        }
    });

    function sendMessage() {
        var userInput = $('#user-input').val();
        $('#chat-box').append('<div class="user-bubble">' + userInput + '</div>'); // 사용자 입력 표시

        $.ajax({
            type: 'POST',
            url: '/chat_service/', // 서버 URL
            data: { input1: userInput },
            success: function(response) {
                if (response.AnswerImageUrl) {
                    // 이미지가 있을 때 답변과 함께 이미지를 추가합니다.
                    $('#chat-box').append(
                        '<img src="https://www.cio.com/wp-content/uploads/2023/08/chatbot_ai_machine-learning_emerging-tech-100778305-orig.jpg?quality=50&strip=all&w=1024" alt="Profile Image" class="profile-image answerer-profile" >' +
                        '<div class="server-bubble">' +
                            response.Answer +
                        '</div>' +
                        '<div class="server-bubble">' +
                            '<img src="' + response.AnswerImageUrl + '" width="100" height="100">' +
                        '</div>'
                    );
                } else {
                    // 이미지가 없을 때는 답변만 추가합니다.
                    $('#chat-box').append(
                    '<img src="https://www.cio.com/wp-content/uploads/2023/08/chatbot_ai_machine-learning_emerging-tech-100778305-orig.jpg?quality=50&strip=all&w=1024" alt="Profile Image" class="profile-image answerer-profile">' +
                    '<div class="server-bubble">' +
                        response.Answer +
                        '</div>');
                }
                $(".chat_content").scrollTop($(".chat_content")[0].scrollHeight); // 자동 스크롤
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });

        $('#user-input').val(''); // 입력 필드 비우기
    }
</script>

</body>
</html>
